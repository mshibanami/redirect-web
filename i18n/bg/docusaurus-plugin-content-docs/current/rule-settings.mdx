# Настройки на правилата

Тази страница предоставя подробна информация за всяка настройка в екрана Редактиране на правило в уеб приложението Redirect Web.

## Опции

### Тип

Задайте опцията **Тип**, за да контролирате как приложението обработва пренасочването. Можете да избирате от следните:

*   **Оригинален** (по подразбиране)
    *   Този тип използва традиционни уеб API-та за контролиране на пренасочването. Освен това, той използва [Tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) за резервен вариант.
        *   Във Firefox той използва [WebRequest API](https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) за обработка на пренасочването.
    *   Можете да използвате всички опции, освен [Типове ресурси](#resource-types) и [Методи на заявка](#request-methods).
    *   Този тип е по-бавен от *Декларативния* тип и може да причини допълнителни мрежови заявки.
*   **DNR** (Експериментално за Safari):
    *   Този тип работи много по-бързо от Оригиналния тип, тъй като не инициира мрежова заявка за изходния URL адрес.
    *   Това ви позволява да зададете [Типове ресурси](#resource-types) и [Методи на заявка](#request-methods).
    *   ⚠️ Не можете да използвате някои опции, като [Обработка на улавящи групи](#capturing-group-processing) и [Изключени URL шаблони](#excluded-url-patterns), тъй като те все още не се поддържат от DNR API.
    *   ⚠️ В Safari в момента не можете да включвате вертикални черти (`|`) във вашия шаблон за регулярен израз. [Подробности](https://github.com/mshibanami/redirect-web/issues/44)
    *   ⚠️ Тъй като DNR API на Safari все още има някои проблеми, считаме, че това все още е експериментална функция за Safari. Можете да намерите списъка с всички известни проблеми [тук](https://github.com/mshibanami/redirect-web/issues?q=state%3Aopen%20label%3ADNR%20label%3ASafari).

### Пренасочване от

Опцията **Пренасочване от** ви позволява да зададете URL шаблон на уеб страници, от които искате да пренасочвате. Можете да изберете [Шаблон със заместващи символи](#wildcard) или [Регулярен израз](#regular-expression).

Например, ако зададете `https://example.com/*` с Шаблон със заместващи символи, той ще съвпадне с `https://example.com/` или `https://example.com/hello`.

> [!NOTE]
> В опцията Пренасочване към можете да препращате към цялото съвпадение, използвайки `$0`, или към частични съвпадения, използвайки `$1`, `$2`, ... Проверете подробностите в [URL шаблон](#url-pattern) на тази страница.

#### Типове ресурси

![Поддържани типове: DNR](https://img.shields.io/badge/Types-DNR-blue)

Опцията **Типове ресурси** ви позволява да зададете категориите уеб заявки, като изображения, JavaScript файлове и таблици със стилове, към които се прилага правилото.
Например, ако зададете `script`, можете да пренасочите JavaScript файловете, заредени от уеб страниците.

В момента са налични следните:
`main_frame`, `sub_frame`, `stylesheet`, `script`, `image`, `font`, `xmlhttprequest`, `ping`, `media`, `websocket`, `other`

Настройката по подразбиране е `main_frame`, която представлява страницата от най-високо ниво, заредена в раздел.

Моля, проверете подробностите за всеки тип ресурс в [mdn web docs](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType).

#### Методи на заявка

![Поддържани типове: DNR](https://img.shields.io/badge/Types-DNR-blue)

Опцията **Методи на заявка** ви позволява да зададете целевите HTTP методи на изходния URL адрес.

Всички методи са зададени по подразбиране.

Моля, проверете подробностите за всеки метод в [mdn web docs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods).

> [!WARNING]
> В Safari тази опция може да не е налична, тъй като текущата реализация на Apple за DNR типа изглежда не я обработва. Изпратихме обратна връзка до Apple като FB14502272.

#### Целеви браузъри

![Поддържани платформи: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Опцията **Целеви браузъри** ви позволява да посочите кой браузър трябва или не трябва да се прилага правилото.

*   Има 2 вида браузъри, които можете да изберете:
    *   **Браузъри, които можете да изберете по подразбиране**: Можете да изберете Safari, Chrome, Firefox, Edge, Opera, Arc, Brave и Vivaldi по подразбиране. Това не разграничава варианти на един и същ браузър, като Safari и Safari Technology Preview.
    *   **Потребителски зададени браузъри**: Чрез докосване на бутона Добавяне в изскачащия прозорец можете да изберете всеки браузър, различен от Safari или Safari Technology Preview, който има инсталирано разширението Redirect Web.
*   Отметката **Всички освен избраните** ви позволява да насочите правилото към всеки браузър, освен към тези, които сте избрали.

> [!WARNING]
> Redirect Web не може да разграничи дали браузърът е **Safari** или **Safari Technology Preview**, защото приложението проверява родителския процес на разширението, за да го открие, но тези два браузъра споделят един и същ родителски процес (`/sbin/launchd`).

### Пренасочване към

Опцията **Пренасочване към** задава целеви URL адрес, към който желаете да пренасочите от изходния URL адрес, съпоставен с опцията *Пренасочване от*. Можете също така да заместите улавящи групи с `$1`, `$2`, ... или цялото съвпадение с `$0`. Те ви помагат динамично да зададете местоназначението. Проверете подробностите в [URL шаблон](#url-pattern) на тази страница.

Например, ако зададете следното правило:

*   **Пренасочване от**: `https://google.com/*` (Шаблон със заместващи символи)
*   **Пренасочване към**: `https://apple.com/$1`

и то съвпадне с `https://google.com/hello`, тогава целевият URL адрес ще бъде `https://apple.com/hello`.

Освен това, можете да променяте текстовете на `$1`, `$2`, ... преди да направите заместванията. Проверете секцията [Обработка на улавящи групи](#capturing-group-processing) за подробности.

> [!TIP]
> Можете да зададете персонализирана схема на URL адрес, за да отворите приложение. Това са примери за приложения, които поддържат дълбоко свързване (deep linking):
>
> *   Figma: `figma://file/Your_Figma_ID`
> *   Firefox: `firefox://open-url?url=https://example.com/hello`
> *   Google Chrome: `googlechromes://example.com`
> *   Microsoft Edge: `microsoft-edge://example.com`
> *   Notion: `notion://www.notion.so/Your_Note_ID`
> *   Slack: `slack://open`

#### Приложение

![Поддържани типове: Оригинални](https://img.shields.io/badge/Types-Original-blue) ![Поддържани платформи: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Ако искате да зададете приложение, с което желаете да отворите целевия URL адрес, използвайте падащия списък **Приложение**. Тази опция е налична само на macOS.

> [!WARNING]
> Можете да отваряте само приложения, които поддържат [App Sandbox](https://developer.apple.com/documentation/security/app_sandbox). Също така се уверете, че приложението поддържа отваряне на URL адреса, който искате да отворите.

### Обработка на улавящи групи

![Поддържани типове: Оригинални](https://img.shields.io/badge/Types-Original-blue)

Опцията **Обработка на улавящи групи** ви позволява да зададете как да обработвате уловените групи, които можете да заместите в опцията *Пренасочване към* с `$1`, `$2`...

Ето как се създават улавящи групи:

*   **Шаблон със заместващи символи**: Текстове, съпоставени с `*` и `?`, се улавят автоматично.
*   **Регулярен израз**: Текстове, съпоставени с част от шаблона в `()`, се улавят.

Можете да изберете един или повече от следните процеси:

*   **URL Кодиране/Декодиране**: Това прилага [процентно кодиране](https://en.wikipedia.org/wiki/Percent-encoding) или декодиране към улавяща група. Например, ако кодирате `https://example.com/hello`, то се преобразува в `https%3A%2F%2Fexample.com%2Fhello`. Декодирането работи по обратния начин.
*   **Base64 Кодиране/Декодиране**: Това декодира/кодира текст в [Base64](https://en.wikipedia.org/wiki/Base64). Например, можете да кодирате `hello` в `aGVsbG8=`, и да го декодирате обратно в `hello`.
*   **Заместване на срещания**: Това замества един или повече символи в група, съпоставени от **Цел**, със **Заместване**. Например, ако *Групата* е `hello`, а *Целта* е `l`, а *Заместването* е `y`, то се модифицира на `heyyo`.

> [!NOTE]
> Това е за обработка на всяка улавяща група и не влияе на това кои URL адреси са изключени от [Изключени URL шаблони](#excluded-url-patterns). Например, да речем, че имате следното правило:
>
> *   **Пренасочване от**: `https://example.com/(hello.*)`
> *   **Обработка на улавящи групи**:
>     *   Група: `$1`
>     *   Цел: `.*` (Регулярен израз)
>     *   Заместване: `hello`
> *   **Изключен URL шаблон**: `https://example.com/hello`
>
> В този случай `https://example.com/hello_world` няма да бъде изключен, докато `https://example.com/hello` ще бъде изключен.

### Изключени URL шаблони

![Поддържани типове: Оригинални](https://img.shields.io/badge/Types-Original-blue)

Опцията **Изключени URL шаблони** ви позволява да зададете URL адреси, които не се пренасочват. Това може да бъде полезно за избягване на цикли на пренасочване или за изключване на определени части от уебсайт от пренасочване.

Можете да зададете изключени URL шаблони, използвайки типове шаблони Регулярен израз или Шаблон със заместващи символи.

### Примери

Опцията **Примери** ви позволява да тествате вашето правило за пренасочване, като предоставите примерни URL адреси. Чрез добавяне на примерен URL адрес можете да проверите дали правилото работи според очакванията, преди да го приложите.

### Коментари

Опцията **Коментари** ви позволява да добавите всякакви бележки или коментари относно вашето правило за пренасочване. Това може да бъде полезно за проследяване защо сте създали конкретно правило или за предоставяне на контекст за други, които биха могли да прегледат вашите правила.

## URL шаблон

Има 3 опции, при които можете да зададете един или повече URL шаблона: *Пренасочване от*, *Изключени URL шаблони* и *Обработка на улавящи групи*. За да ги зададете, можете да изберете или **Шаблон със заместващи символи**, или **Регулярен израз**.

### Шаблон със заместващи символи

**Шаблон със заместващи символи** е по-опростен тип шаблон, който ви позволява да използвате `*` (съвпада с всичко) и `?` (съвпада с всеки един символ) като заместващи символи. Ето няколко примера:

*   За да съвпадне с `https://example.com/hello`, можете да използвате `https://example.com/*`. Това ще съвпадне с всеки низ след `https://example.com/`.
*   За да съвпадне с `https://example.com/search?q=hello`, можете да използвате `https://example.com/search?q=*`. Това ще съвпадне с всяка стойност за параметъра `q`.
*   За да съвпадне с всеки URL адрес, който съдържа думата `blog`, можете да използвате `*blog*`.

Можете също така да използвате заместване в Шаблон със заместващи символи, което означава, че можете да препращате към части от съвпадащия URL адрес, използвайки `$1`, `$2` и т.н. Например, ако използвате `https://example.com/*-world-*` и URL адресът е `https://example.com/hello-world-goodbye`, тогава `$1` ще бъде "hello", а `$2` ще бъде "goodbye". `$0` също е налично за препращане към целия съвпадащ URL адрес.

> [!Note]
> Въпреки че заместването е функция на Регулярния израз, можете да го използвате и за Шаблон със заместващи символи, тъй като Redirect Web вътрешно преобразува Шаблона със заместващи символи в Регулярен израз.

### Регулярен израз

**Регулярен израз** (Regex) е мощен инструмент за съвпадение на шаблони в текст, задвижван от двигателя за регулярни изрази на Apple, който е описан [тук](https://developer.apple.com/documentation/foundation/nsregularexpression#1661042). Той ви позволява да дефинирате специфичен шаблон, който съвпада с набор от низове. Ето няколко примера.

- За да съвпадне с `https://example.com/hello`, можете да използвате `https://example.com/(.*)`. Това ще съвпадне с всеки низ след `https://example.com/` и ще го съхрани в улавяща група.
- За да съвпадне с `https://example.com/search?q=hello`, можете да използвате `https://example.com/search\?q=(.*)`. Това ще съвпадне със стойността на параметъра `q` и ще я съхрани в улавяща група.
- За да съвпадне с всеки URL адрес, който съдържа думата `blog`, можете да използвате `.*blog.*`.

Можете да препращате към улавящите групи в *Пренасочване към* или *Заместване*, използвайки `$1`, `$2`, ... или `$0` за препращане към цялото съвпадение.

Повече информация за синтаксиса на регулярните изрази може да намерите в ресурси като [RegExr](https://regexr.com/).
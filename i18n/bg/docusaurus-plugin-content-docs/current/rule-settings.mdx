# Настройки на правилата

Тази страница предоставя подробна информация за всяка настройка в екрана "Редактиране на правило" в приложението Redirect Web.

## Опции

### Тип {#type}

Задайте опцията **Тип**, за да контролирате как приложението обработва пренасочването. Можете да избирате от следните:

*   **Оригинален** (По подразбиране)
    *   Това използва традиционни уеб API за контрол на пренасочването. Освен това използва [Tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) като резервен вариант.
        *   Във Firefox използва [WebRequest API](https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) за обработка на пренасочването.
    *   Можете да използвате всички опции, освен [Типове ресурси](#resource-types) и [Методи на заявка](#request-methods).
    *   Това е по-бавно от типа *Декларативен* и може да причини допълнителни мрежови заявки.
*   **DNR** (Експериментален за Safari):
    *   Този тип работи много по-бързо от оригиналния тип, тъй като не инициира мрежова заявка за изходния URL адрес.
    *   Това ви позволява да зададете [Типове ресурси](#resource-types) и [Методи на заявка](#request-methods).
    *   ⚠️ Не можете да използвате някои опции, като [Обработка на групи за улавяне](#capturing-group-processing) и [Изключени URL шаблони](#excluded-url-patterns), тъй като те все още не се поддържат от DNR API.
    *   ⚠️ В Safari в момента не можете да включвате вертикални черти (`|`) във вашия шаблон за регулярен израз. [Подробности](https://github.com/mshibanami/redirect-web/issues/44)
    *   ⚠️ Тъй като DNR API на Safari все още има някои проблеми, считаме, че това все още е експериментална функция за Safari. Можете да намерите списъка с всички известни проблеми [тук](https://github.com/mshibanami/redirect-web/issues?q=state%3Aopen%20label%3ADNR%20label%3ASafari).

### Пренасочване от {#redirect-from}

Опцията **Пренасочване от** ви позволява да зададете URL шаблон на уеб страници, от които искате да пренасочите. Можете да изберете [Wildcard](#wildcard) или [Регулярен израз](#regular-expression).

Например, ако зададете `https://example.com/*` с Wildcard, той ще съвпадне с `https://example.com/` или `https://example.com/hello`.

> [!NOTE]
> В опцията "Пренасочване към" можете да се позовавате на цялото съвпадение, използвайки `$0`, или на частични съвпадения, използвайки `$1`, `$2`, ... Проверете подробностите в [URL шаблон](#url-pattern) на тази страница.

#### Типове ресурси {#resource-types}

![Поддържани типове: DNR](https://img.shields.io/badge/Types-DNR-blue)

Опцията **Типове ресурси** ви позволява да зададете категориите уеб заявки, като изображения, JavaScript и стилови таблици, за които се прилага правилото.
Например, ако зададете `script`, можете да пренасочите JavaScript файловете, заредени от уеб страници.

В момента са налични следните:
`main_frame`, `sub_frame`, `stylesheet`, `script`, `image`, `font`, `xmlhttprequest`, `ping`, `media`, `websocket`, `other`

Настройката по подразбиране е `main_frame`, която е страницата от най-високо ниво, заредена в раздел.

Моля, проверете подробностите за всеки тип ресурс в [mdn web docs](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType).

#### Методи на заявка {#request-methods}

![Поддържани типове: DNR](https://img.shields.io/badge/Types-DNR-blue)

Опцията **Методи на заявка** ви позволява да зададете целевите HTTP методи на изходния URL адрес.

Всички методи са зададени по подразбиране.

Моля, проверете подробностите за всеки метод в [mdn web docs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods).

> [!WARNING]
> В Safari тази опция може да не е налична, тъй като имплементацията на Apple за типа DNR изглежда не я обработва в момента. Изпратихме обратна връзка до Apple като FB14502272.

#### Целеви браузъри {#target-browsers}

![Поддържани платформи: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Опцията **Целеви браузъри** ви позволява да зададете за кой браузър трябва или не трябва да се прилага правилото.

*   Има 2 типа браузъри, които можете да изберете:
    *   **Браузъри, които можете да изберете по подразбиране**: Можете да изберете Safari, Chrome, Firefox, Edge, Opera, Arc, Brave и Vivaldi по подразбиране. Това не прави разлика между варианти на един и същ браузър, като Safari и Safari Technology Preview.
    *   **Потребителски зададени браузъри**: Чрез докосване на бутона "Добавяне" в изскачащия прозорец можете да изберете всеки браузър, различен от Safari или Safari Technology Preview, който има инсталирано разширението Redirect Web.
*   Отметката **Всички освен избраните** ви позволява да насочите всеки браузър, освен тези, които сте избрали.

> [!WARNING]
> Redirect Web не може да различи дали браузърът е **Safari** или **Safari Technology Preview**, тъй като приложението проверява родителския процес на разширението, за да го открие, но тези два браузъра споделят един и същ родителски процес (`/sbin/launchd`).

### Пренасочване към {#redirect-to}

Опцията **Пренасочване към** задава целеви URL адрес, към който желаете да пренасочите, от изходния URL адрес, съвпадащ с опцията *Пренасочване от*. Можете също така да замените групи за улавяне с `$1`, `$2`, ... или цялото съвпадение с `$0`. Те ви помагат динамично да зададете дестинацията. Проверете подробностите в [URL шаблон](#url-pattern) на тази страница.

Например, ако зададете следното правило:

*   **Пренасочване от**: `https://google.com/*` (Wildcard)
*   **Пренасочване към**: `https://apple.com/$1`

и то съвпада с `https://google.com/hello`, тогава целевият URL адрес ще бъде `https://apple.com/hello`.

Освен това можете да променяте текстовете на `$1`, `$2`, ... преди да направите замествания. Проверете секцията [Обработка на групи за улавяне](#capturing-group-processing) за подробности.

> [!TIP]
> Можете да зададете персонализирана URL схема за отваряне на приложение. Това са примери за приложения, които поддържат дълбоко свързване:
>
> *   Figma: `figma://file/Your_Figma_ID`
> *   Firefox: `firefox://open-url?url=https://example.com/hello`
> *   Google Chrome: `googlechromes://example.com`
> *   Microsoft Edge: `microsoft-edge://example.com`
> *   Notion: `notion://www.notion.so/Your_Note_ID`
> *   Slack: `slack://open`

#### Приложение {#application}

![Поддържани типове: Оригинален](https://img.shields.io/badge/Types-Original-blue) ![Поддържани платформи: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Ако искате да зададете приложение, с което желаете да отворите целевия URL адрес, използвайте комбинираното поле **Приложение**. Това е налично само за macOS.

> [!WARNING]
> Можете да отворите само приложение, което поддържа [App Sandbox](https://developer.apple.com/documentation/security/app_sandbox). Също така се уверете, че приложението поддържа отваряне на URL адреса, който искате да отворите.

### Обработка на групи за улавяне {#capturing-group-processing}

![Поддържани типове: Оригинален](https://img.shields.io/badge/Types-Original-blue)

Опцията **Обработка на групи за улавяне** ви позволява да зададете как да се обработват уловените групи, които можете да замените в опцията *Пренасочване към* с `$1`, `$2`...

Ето как се правят групи за улавяне:

*   **Wildcard**: Текстовете, съвпадащи с `*` и `?`, се улавят автоматично.
*   **Регулярен израз**: Текстовете, съвпадащи с част от шаблона вътре в `()`, се улавят.

Можете да изберете един или повече от следните процеси:

*   **URL кодиране/декодиране**: Това прилага [процентно кодиране](https://en.wikipedia.org/wiki/Percent-encoding) или декодиране към група за улавяне. Например, ако кодирате `https://example.com/hello`, то се преобразува в `https%3A%2F%2Fexample.com%2Fhello`. Декодирането работи по обратния начин.
*   **Base64 кодиране/декодиране**: Това декодира/кодира текст в [Base64](https://en.wikipedia.org/wiki/Base64). Например, можете да кодирате `hello` в `aGVsbG8=`, и да го декодирате обратно в `hello`.
*   **Замяна на срещания**: Това заменя един или повече символи в група, съвпадащи с **Цел**, с **Замяна**. Например, ако *Групата* е `hello`, а *Целта* е `l`, а *Замяната* е `y`, тя се променя на `heyyo`.

> [!NOTE]
> Това е за обработка на всяка група за улавяне и не засяга кои URL адреси са изключени от [Изключени URL шаблони](#excluded-url-patterns). Например, да кажем, че имате това правило:
>
> *   **Пренасочване от**: `https://example.com/(hello.*)`
> *   **Обработка на групи за улавяне**:
>     *   Група: `$1`
>     *   Цел: `.*` (Регулярен израз)
>     *   Замяна: `hello`
> *   **Изключен URL шаблон**: `https://example.com/hello`
>
> В този случай `https://example.com/hello_world` няма да бъде изключен, докато `https://example.com/hello` ще бъде изключен.

### Изключени URL шаблони {#excluded-url-patterns}

![Поддържани типове: Оригинален](https://img.shields.io/badge/Types-Original-blue)

Опцията **Изключени URL шаблони** ви позволява да зададете URL адресите, които не се пренасочват. Това може да бъде полезно за избягване на цикли на пренасочване или за изключване на определени части от уебсайт от пренасочване.

Можете да зададете изключени URL шаблони, използвайки типове шаблони за регулярен израз или Wildcard.

### Примери {#examples}

Опцията **Примери** ви позволява да тествате вашето правило за пренасочване, като предоставите примерни URL адреси. Чрез добавяне на примерен URL адрес можете да проверите дали правилото работи според очакванията, преди действително да го приложите.

### Коментари {#comments}

Опцията **Коментари** ви позволява да добавяте всякакви бележки или коментари относно вашето правило за пренасочване. Това може да бъде полезно за проследяване защо сте създали конкретно правило или за предоставяне на контекст за други, които могат да преглеждат вашите правила.

Можете да пишете коментари в следните формати:

*   **Обикновен текст** (По подразбиране): Прост текст без форматиране.
*   **Markdown**: Можете да използвате [синтаксиса на Markdown на GitHub](https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax), включително някои разширения, които GFM не поддържа. Например, можете да създавате заглавия, списъци, връзки и други.
*   **AsciiDoc**: Можете да използвате [синтаксиса на AsciiDoc](https://asciidoc.org/), за да форматирате вашите коментари.

## URL шаблон {#url-pattern}

**URL шаблоните** се използват за съвпадение на URL адреси в опциите *Пренасочване от*, *Изключени URL шаблони* и *Обработка на групи за улавяне*. За да ги зададете, можете да изберете [Wildcard](#url-pattern-wildcard) или [Регулярен израз](#url-pattern-regular-expression).

### Wildcard {#url-pattern-wildcard}

**Wildcard** е по-прост тип шаблон, който ви позволява да използвате `*` (съвпада с всичко) и `?` (съвпада с всеки един символ) като заместващи символи. Ето няколко примера:

*   За да съвпадне с `https://example.com/hello`, можете да използвате `https://example.com/*`. Това ще съвпадне с всеки низ след `https://example.com/`.
*   За да съвпадне с `https://example.com/search?q=hello`, можете да използвате `https://example.com/search?q=*`. Това ще съвпадне с всяка стойност за параметъра `q`.
*   За да съвпадне с всеки URL адрес, който съдържа думата `blog`, можете да използвате `*blog*`.

Можете също така да използвате заместване в Wildcard, което означава, че можете да се позовавате на части от съвпадащия URL адрес, използвайки `$1`, `$2` и т.н. Например, ако използвате `https://example.com/*-world-*` и URL адресът е `https://example.com/hello-world-goodbye`, тогава `$1` ще бъде "hello", а `$2` ще бъде "goodbye". `$0` също е налично за позоваване на целия съвпадащ URL адрес.

> [!NOTE]
> Въпреки че заместването е функция на регулярния израз, можете да го използвате и за Wildcard, тъй като Redirect Web вътрешно преобразува Wildcard в регулярен израз.

### Регулярен израз {#url-pattern-regular-expression}

**Регулярният израз** (Regex) е мощен инструмент за съвпадение на шаблони в текст и също така е широко използван в програмирането. Той ви позволява да дефинирате специфичен шаблон, който съвпада с набор от низове. Ето няколко примера.

-   За да съвпадне с `https://example.com/hello`, можете да използвате `https://example.com/.*`. Това ще съвпадне с всеки низ след `https://example.com/`.
-   За да съвпадне с `https://example.com/search?q=hello`, можете да използвате `https://example.com/search?q=(.*)`. Това ще съвпадне със стойността на параметъра `q` и ще я съхрани в група за улавяне. След това можете да се позовавате на нея, използвайки `$1` в опцията *Пренасочване към*.
-   За да съвпадне с всеки URL адрес, който съдържа думата `blog`, можете да използвате `.*blog.*`.

Можете да се позовавате на групите за улавяне в *Пренасочване към* или *Замяна*, използвайки `$1`, `$2`, ... или `$0` за позоваване на цялото съвпадение.

Redirect Web се захранва от [Regex двигателя на Apple](https://developer.apple.com/documentation/foundation/nsregularexpression#1661042).

Повече информация за синтаксиса на Regex може да бъде намерена в ресурси като [RegExr](https://regexr.com/).
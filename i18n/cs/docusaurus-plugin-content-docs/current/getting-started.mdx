# Začínáme

Tato stránka popisuje běžné případy použití pro vytváření pravidel ve webové aplikaci Redirect.

(Podrobnosti o nastavení pravidel se také dozvíte na stránce [Nastavení pravidel](./rule-settings).)


## Případ 1: Otevřete jiný web

Předpokládejme, že jste závislí na Twitteru a rozhodli jste se meditovat v aplikaci Insight Timer, kdykoli náhodou otevřete Twitter. Pojďme pro to vytvořit pravidlo!

### Krok 1. Nastavte "Přesměrovat z"

Nejprve byste měli v aplikaci na obrazovce *Upravit pravidlo* nastavit sekci *Přesměrovat z*. Cíle jsou URL adresy začínající na `https://twitter.com/`.

V tomto případě můžete zadat následující vzor v režimu [Zástupný znak](rule-settings?id=wildcard):

```
https://twitter.com/*
```

V režimu Zástupný znak znamená `*`, že se shoduje s čímkoli (= nula nebo více znaků).

Nicméně, počkejte. `twitter.com` bylo přejmenováno na `x.com`. Můžete jednoduše nahradit `twitter.com` za `x.com`, ale nikdo neví, kdy si nový majitel znovu rozmyslí, že to vrátí zpět. Proto se zaměřme na `twitter.com` i `x.com`.

Chcete-li to provést, přepněte ze Zástupného znaku na [Regulární výraz](rule-settings?id=regular-expression) a nastavte toto jako vzor:

```
https://(twitter|x).com/.*
```

* `(twitter|x)`: cílí jak na `twitter`, tak na `x`. (`|` se nazývá *svislá čára*.)
* `.*`: Je to stejné jako `*` u zástupného znaku. Konkrétněji, `.` znamená *jakýkoli znak* a `*` znamená *cokoli před tímto symbolem opakováno libovolněkrát*, což ve výsledku znamená shodu s čímkoli.

Regulární výraz je trochu složitý, ale jakmile si na něj zvyknete, bude to mocný nástroj. Doporučujeme použít [RegExr](https://regexr.com) jako „hřiště“ pro analýzu toho, jak funguje váš vzor regulárního výrazu.

> [!NOTE]
> V regulárních výrazech je `.` v `(twitter|x).com` také považován za *jakýkoli znak*. Proto `(twitter|x).com/.*` také odpovídá například `twitter1com/` nebo `x_com/`.
>
> Abyste tomu předešli, můžete to změnit na `(twitter|x)\.com/.*`. `\` se používá k úniku speciálního znaku.
>
> Nicméně takové URL adresy se v obecném internetovém prostředí nevyskytují. Proto můžete `.` ponechat jako speciální znak, pokud si to přejete. Vaše pravidlo je pro vaše vlastní použití, takže ho implementujte podle svého uvážení.

### Krok 2: Nastavte "Přesměrovat na"

Jednoduše zadejte URL takto:

```
https://insighttimer.com/saraauster/guided-meditations/calm
```

Nyní vás Redirect Web přenese k meditaci, kdykoli se pokusíte přistupovat k Twitteru!

**[⬇️ Stáhnout pravidlo](/rules/reduce-twitter-addiction.redirectweb)**

## Případ 2: Odstranění parametrů dotazu z URL

Předpokládejme, že v URL adrese `example.com` existuje parametr dotazu `source=twitter` a vy jste se rozhodli jej odstranit, abyste se anonymizovali.

V tomto případě je nejsnazší volbou **Zpracování zachytávající skupiny**:

* **Přesměrovat z**: `https://example.com/*` (Zástupný znak)
* **Přesměrovat na**: `$0`
* **Zpracování zachytávající skupiny**:
    * **Skupina**: `$0`
    * **Proces**: Nahradit výskyty
        * **Cíl**: `&?source=[^&]*`
        * **Náhrada**: *(žádná)*
        * **Vzor textu**: Regulární výraz

**[⬇️ Stáhnout pravidlo](/rules/remove-parameters.redirectweb)**

Toto pravidlo funguje následovně:

```
https://example.com/?source=twitter
↪ https://example.com/?

https://example.com/?hello=world&source=twitter&foo=bar
↪ https://example.com/?hello=world&foo=bar
```

Pokud chcete odstranit více parametrů, přidejte další procesy.

## Případ 3: Přidání parametrů dotazu do URL

Řekněme, že existuje webová stránka s názvem `example.com`, která standardně zobrazuje mobilní rozložení, ale vy preferujete desktopové rozložení. Naštěstí webová stránka podporuje parametr dotazu `layout` pro určení, jaké rozložení se má zobrazit. Vytvořme pravidlo, které automaticky přidá `layout=desktop`.

Možná si myslíte, že byste to mohli definovat následovně:

* **Přesměrovat z**: `https://example.com/.*` (Regulární výraz)
* **Přesměrovat na**: `$0?layout=desktop`

`$0` odkazuje na cílovou URL. Pokud se pokusíte přistoupit na `example.com/hello`, budete přesměrováni na `example.com/hello?layout=desktop`. Tato funkce se nazývá *substituce*.

> [!TIP]
> Substituce je k dispozici také pro režim Zástupný znak, protože se interně převádí na Regulární výraz.

Nicméně, s těmito nastaveními je několik problémů.

### Problém 1: Nekonečná smyčka

Současné nastavení vytváří nekonečnou přesměrovávací smyčku, protože `https://example.com/.*` cílí také na `https://example.com/hello?layout=desktop`.

V tomto případě můžete zadat vyloučený vzor URL, který vám umožní přístup bez přesměrování, například takto s Regulárním výrazem:

```
.*[&?]layout=[^&]*.*
```

* `.*`: Shoduje se s čímkoli
* `[&?]`: Shoduje se buď s `&` nebo s `?`
* `[^&]*`: Shoduje se s čímkoli kromě `&`

### Problém 2: Nelze správně zpracovat existující parametry

Pokud cílová URL již obsahuje jiné parametry dotazu, například `example.com/hello?theme=dark`, cílová adresa bude `example.com/hello?theme=dark?layout=desktop` (v URL jsou dva `?`), ale parametry můžete spojit pouze pomocí `&`. `?` jako speciální znak je povolen pouze na začátku parametrů. Není tedy považován za platný parametr.

V tomto případě změňte nastavení takto:

* **Přesměrovat z**: `(https://example.com/[^?]*)(\?(.*))?`
* **Přesměrovat na**: `$1?layout=desktop&$3`

Pojďme se podívat krok za krokem.

* `(https://example.com/[^?]*)`: Shoduje se s částí až do předchozího znaku `?`.
    * `[^?]*` se shoduje s čímkoli kromě `?`.
    * Toto je obaleno `()` , takže na to můžete později odkazovat pomocí `$1`.
* `(\?(.*))?`: Shoduje se s řetězcem začínajícím na `?`, což znamená parametry dotazu.
    * Toto také odpovídá prázdnému řetězci díky kvantifikátoru `?` na konci vzoru, který *odpovídá nula nebo jedenkrát*.
    * Vnější `()` a vnitřní `()` lze později odkazovat pomocí `$2` a `$3`.

[RegExr](https://regexr.com) vám může pomoci pochopit detaily.

> [!NOTE]
> RegExr zobrazí chybu, pokud `\` neescapujete s `/`. Ačkoli to můžete escapovat, není to vyžadováno, protože Redirect Web používá jiný engine od Apple, který escapování nevyžaduje.

Toto není dokonalé řešení, protože přesměrovává `example.com/hello` na `example.com/hello?layout=desktop&`, což obsahuje zbytečné `&` na konci URL. Obecně to není velký problém, ale pokud si přejete jej odstranit, můžete použít *Zpracování zachytávající skupiny*.

Závěrem, toto je konečný výstup:

* **Přesměrovat z**: `(https://example.com/[^?]*)((\?(.*))?)` (Regulární výraz)
* **Přesměrovat na**: `$1?layout=desktop$3`
* **Vyloučený vzor URL**: `.*[&?]layout=[^&]*.*` (Regulární výraz)
* **Zpracování zachytávající skupiny**:
    * **Skupina**: `$3`
    * **Proces**: Nahradit výskyty
        * **Cíl**: `\?(.*)`
        * **Náhrada**: `&$1`

**[⬇️ Stáhnout pravidlo](/rules/add-parameters.redirectweb)**

Toto je pouze příklad. Můžete také vytvořit více pravidel pro řešení každého problému. Může to být mnohem jednodušší.
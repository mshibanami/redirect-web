# Начало работы

На этой странице описаны распространённые сценарии использования для создания правил в веб-приложении Redirect Web.

(Вы также можете узнать подробности о настройках правил на странице [Настройки правил](./rule-settings).)


## Случай 1: Открытие другого веб-сайта

Предположим, вы зависимы от Twitter и решаете медитировать в Insight Timer каждый раз, когда случайно открываете Twitter. Давайте создадим правило для этого!

### Шаг 1. Настройка "Перенаправить с" (Redirect From)

Сначала вам следует настроить раздел *Redirect From* на экране *Edit Rule* в приложении. Целью являются URL-адреса, начинающиеся с `https://twitter.com/`.

В этом случае вы можете указать следующий шаблон в режиме [Wildcard](rule-settings?id=wildcard):

```
https://twitter.com/*
```

В режиме Wildcard, `*` означает, что он соответствует чему угодно (= ноль или более символов).

Однако подождите. `twitter.com` был переименован в `x.com`. Вы можете просто заменить `twitter.com` на `x.com`, но никто не знает, когда новый владелец снова передумает и вернёт старое название. Поэтому давайте нацелимся как на `twitter.com`, так и на `x.com`.

Для этого переключитесь с Wildcard на [Регулярное выражение](rule-settings?id=regular-expression) и установите следующий шаблон:

```
https://(twitter|x).com/.*
```

* `(twitter|x)`: соответствует как `twitter`, так и `x`. (`|` называется *оператором ИЛИ*.)
* `.*`: то же самое, что `*` в Wildcard. Более конкретно, `.` означает *любой символ*, а `*` означает *что угодно перед этим символом, повторяющееся любое количество раз*, в результате чего он соответствует всему.

Регулярные выражения немного сложны, но как только вы к ним привыкнете, они станут мощным инструментом. Мы рекомендуем использовать [RegExr](https://regexr.com) в качестве песочницы для анализа того, как работает ваш шаблон регулярного выражения.

> [!NOTE]
> В регулярных выражениях `.` в `(twitter|x).com` также трактуется как *любой символ*. Поэтому `(twitter|x).com/.*` также соответствует, например, `twitter1com/` или `x_com/`.
>
> Чтобы избежать этого, вы можете изменить его на `(twitter|x)\.com/.*`. `\` используется для экранирования специального символа.
>
> Однако таких URL-адресов в обычной интернет-среде не существует. Поэтому вы можете оставить `.` как специальный символ, если вам так удобнее. Ваше правило предназначено для вашего собственного использования, поэтому реализуйте его по своему усмотрению.

### Шаг 2: Настройка "Перенаправить на" (Redirect To)

Просто укажите URL следующим образом:

```
https://insighttimer.com/saraauster/guided-meditations/calm
```

Теперь Redirect Web перенаправляет вас на медитацию, когда вы заходите в Twitter!

**[⬇️ Скачать правило](/rules/reduce-twitter-addiction.redirectweb)**

## Случай 2: Удаление параметров запроса из URL

Предположим, в URL-адресе `example.com` есть параметр запроса `source=twitter`, и вы решили удалить его, чтобы сохранить анонимность.

В этом случае самый простой способ — использовать опцию **Обработка групп захвата (Capturing Group Processing)**:

* **Перенаправить с (Redirect From)**: `https://example.com/*` (Wildcard)
* **Перенаправить на (Redirect To)**: `$0`
* **Обработка групп захвата (Capturing Group Processing)**:
    * **Группа (Group)**: `$0`
    * **Процесс (Process)**: Заменить вхождения (Replace Occurrences)
        * **Цель (Target)**: `&?source=[^&]*`
        * **Замена (Replacement)**: *(нет)*
        * **Шаблон текста (Text Pattern)**: Регулярное выражение (Regular Expression)

**[⬇️ Скачать правило](/rules/remove-parameters.redirectweb)**

Это правило работает следующим образом:

```
https://example.com/?source=twitter
↪ https://example.com/?

https://example.com/?hello=world&source=twitter&foo=bar
↪ https://example.com/?hello=world&foo=bar
```

Если вы хотите удалить больше параметров, добавьте больше процессов.

## Случай 3: Добавление параметров запроса к URL

Допустим, есть веб-сайт `example.com`, который по умолчанию отображает мобильный макет, но вы предпочитаете его десктопный макет. К счастью, веб-сайт поддерживает параметр запроса `layout` для указания того, какой макет отображается. Давайте создадим правило, которое автоматически добавляет `layout=desktop`.

Возможно, вы думаете, что можете определить это следующим образом:

* **Перенаправить с (Redirect From)**: `https://example.com/.*` (Регулярное выражение)
* **Перенаправить на (Redirect To)**: `$0?layout=desktop`

`$0` ссылается на целевой URL. Если вы попытаетесь получить доступ к `example.com/hello`, вы будете перенаправлены на `example.com/hello?layout=desktop`. Эта функция называется *подстановкой*.

> [!TIP]
> Подстановка также доступна для режима Wildcard, так как он внутренне преобразуется в регулярное выражение.

Однако, есть несколько проблем с этими настройками.

### Проблема 1: Бесконечный цикл

Текущая настройка создает бесконечный цикл перенаправлений, поскольку `https://example.com/.*` также нацеливается на `https://example.com/hello?layout=desktop`.

В этом случае вы можете указать исключенный шаблон URL, который позволяет получить доступ без перенаправления, например, с использованием регулярного выражения:

```
.*[&?]layout=[^&]*.*
```

* `.*`: соответствует всему
* `[&?]`: соответствует либо `&`, либо `?`
* `[^&]*`: соответствует всему, кроме `&`

### Проблема 2: Неправильная обработка существующих параметров

Если целевой URL уже имеет другие параметры запроса, такие как `example.com/hello?theme=dark`, то конечный URL будет `example.com/hello?theme=dark?layout=desktop` (в URL два `?`), но вы можете объединять параметры только с помощью `&`. `?` как специальный символ разрешен только в начале параметров. Поэтому это не рассматривается как действительный параметр.

В этом случае измените настройки следующим образом:

* **Перенаправить с (Redirect From)**: `(https://example.com/[^?]*)(\?(.*))?`
* **Перенаправить на (Redirect To)**: `$1?layout=desktop&$3`

Рассмотрим пошагово.

* `(https://example.com/[^?]*)`: Соответствует части до символа `?`.
    * `[^?]*` соответствует всему, кроме `?`.
    * Это заключено в `()`, поэтому вы можете ссылаться на это как на `$1` позже.
* `(\?(.*))?`: Соответствует строке, начинающейся с `?`, что означает параметры запроса.
    * Это также соответствует пустой строке благодаря квантификатору `?` в конце шаблона, который *соответствует нулю или одному разу*.
    * На внешние `()` и внутренние `()` можно будет ссылаться как на `$2` и `$3` позже.

[RegExr](https://regexr.com) может помочь вам понять детали.

> [!NOTE]
> RegExr показывает ошибку, если вы не экранируете `/` с помощью `\`. Хотя вы можете экранировать его, это не требуется, так как Redirect Web использует другой движок от Apple, который не требует экранирования.

Это не идеальное решение, так как оно перенаправляет `example.com/hello` на `example.com/hello?layout=desktop&`, что включает ненужный `&` в конце URL. В целом это не большая проблема, но если вы хотите удалить его, вы можете использовать *Обработку групп захвата (Capturing Group Processing)*.

В заключение, вот окончательный вариант:

* **Перенаправить с (Redirect From)**: `(https://example.com/[^?]*)((\?(.*))?)` (Регулярное выражение)
* **Перенаправить на (Redirect To)**: `$1?layout=desktop$3`
* **Исключенный шаблон URL (Excluded URL Pattern)**: `.*[&?]layout=[^&]*.*` (Регулярное выражение)
* **Обработка групп захвата (Capturing Group Processing)**:
    * **Группа (Group)**: `$3`
    * **Процесс (Process)**: Заменить вхождения (Replace Occurrences)
        * **Цель (Target)**: `\?(.*)`
        * **Замена (Replacement)**: `&$1`

**[⬇️ Скачать правило](/rules/add-parameters.redirectweb)**

Это всего лишь пример. Вы также можете создать несколько правил для решения каждой проблемы. Это может быть гораздо проще.
# Настройки правила

На этой странице представлена подробная информация о каждой настройке на экране "Редактировать правило" в приложении Redirect Web.

## Параметры

### Тип

Параметр **Тип** позволяет управлять тем, как приложение обрабатывает перенаправления. Вы можете выбрать один из следующих вариантов:

*   **Original** (По умолчанию)
    *   Этот тип использует традиционные веб-API для управления перенаправлением. Дополнительно, он использует [API вкладок (Tabs API)](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) в качестве запасного варианта.
        *   В Firefox он использует [API WebRequest](https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) для обработки перенаправления.
    *   Вы можете использовать все параметры, кроме [Типов ресурсов](#resource-types) и [Методов запроса](#request-methods).
    *   Этот тип медленнее, чем *Декларативный*, и может вызывать дополнительные сетевые запросы.
*   **DNR** (Экспериментально для Safari):
    *   Этот тип работает значительно быстрее, чем тип Original, поскольку он не инициирует сетевой запрос для исходного URL.
    *   Это позволяет указывать [Типы ресурсов](#resource-types) и [Методы запроса](#request-methods).
    *   ⚠️ Вы не можете использовать некоторые параметры, такие как [Обработка групп захвата](#capturing-group-processing) и [Исключенные шаблоны URL](#excluded-url-patterns), поскольку они еще не поддерживаются API DNR.
    *   ⚠️ В Safari в настоящее время нельзя включать символы вертикальной черты (`|`) в шаблон регулярного выражения. [Подробности](https://github.com/mshibanami/redirect-web/issues/44)
    *   ⚠️ Поскольку API DNR в Safari все еще имеет некоторые проблемы, мы считаем его экспериментальной функцией для Safari. Список всех известных проблем можно найти [здесь](https://github.com/mshibanami/redirect-web/issues?q=state%3Aopen%20label%3ADNR%20label%3ASafari).

### Перенаправлять с

Параметр **Перенаправлять с** позволяет указать шаблон URL веб-страниц, с которых вы хотите выполнить перенаправление. Вы можете выбрать либо [Маску (Wildcard)](#wildcard), либо [Регулярное выражение](#regular-expression).

Например, если вы укажете `https://example.com/*` с использованием маски (Wildcard), это будет соответствовать `https://example.com/` или `https://example.com/hello`.

> [!NOTE]
> В параметре "Перенаправлять на" (Redirect To) вы можете ссылаться на все совпадение, используя `$0`, или на частичные совпадения, используя `$1`, `$2`, ... Подробности см. в разделе [Шаблон URL](#url-pattern) на этой странице.

#### Типы ресурсов

![Supported Types: DNR](https://img.shields.io/badge/Types-DNR-blue)

Параметр **Типы ресурсов** позволяет указать категории веб-запросов, такие как изображения, JavaScript-файлы и таблицы стилей, к которым применяется правило.
Например, если вы установите `script`, вы сможете перенаправлять JavaScript-файлы, загружаемые веб-страницами.

В настоящее время доступны следующие:
`main_frame`, `sub_frame`, `stylesheet`, `script`, `image`, `font`, `xmlhttprequest`, `ping`, `media`, `websocket`, `other`

Настройка по умолчанию — `main_frame`, что означает страницу верхнего уровня, загруженную во вкладку.

Пожалуйста, проверьте подробности каждого типа ресурса в [документации mdn web docs](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType).

#### Методы запроса

![Supported Types: DNR](https://img.shields.io/badge/Types-DNR-blue)

Параметр **Методы запроса** позволяет установить целевые методы HTTP для исходного URL.

По умолчанию установлены все методы.

Пожалуйста, проверьте подробности каждого метода в [документации mdn web docs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods).

> [!WARNING]
> В Safari эта опция может быть недоступна, так как текущая реализация типа DNR от Apple, похоже, не поддерживает ее. Мы отправили отзыв в Apple под номером FB14502272.

#### Целевые браузеры

![Supported Platforms: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Параметр **Целевые браузеры** позволяет указать, к какому браузеру правило должно или не должно применяться.

*   Вы можете выбрать 2 типа браузеров:
    *   **Браузеры, доступные по умолчанию**: По умолчанию вы можете выбрать Safari, Chrome, Firefox, Edge, Opera, Arc, Brave и Vivaldi. Этот список не различает варианты одного и того же браузера, такие как Safari и Safari Technology Preview.
    *   **Браузеры, указанные пользователем**: Нажав кнопку "Добавить" во всплывающем окне, вы можете выбрать любой браузер, кроме Safari или Safari Technology Preview, в котором установлено расширение Redirect Web.
*   Флажок **Все, кроме выбранных** позволяет применять правило ко всем браузерам, за исключением тех, которые вы выбрали.

> [!WARNING]
> Redirect Web не может различить, является ли браузер **Safari** или **Safari Technology Preview**, потому что приложение проверяет родительский процесс расширения для его определения, но эти два браузера используют один и тот же родительский процесс (`/sbin/launchd`).

### Перенаправлять на

Параметр **Перенаправлять на** указывает целевой URL, на который вы хотите перенаправить с исходного URL, соответствующего параметру *Перенаправлять с*. Вы также можете подставлять захваченные группы с помощью `$1`, `$2`, ... или все совпадение с помощью `$0`. Это помогает динамически указывать место назначения. Подробности см. в разделе [Шаблон URL](#url-pattern) на этой странице.

Например, если вы установите следующее правило:

*   **Перенаправлять с**: `https://google.com/*` (Маска)
*   **Перенаправлять на**: `https://apple.com/$1`

и оно соответствует `https://google.com/hello`, тогда целевой URL будет `https://apple.com/hello`.

Кроме того, вы можете изменять тексты `$1`, `$2`, ... перед выполнением подстановок. Подробности см. в разделе [Обработка групп захвата](#capturing-group-processing).

> [!TIP]
> Вы можете указать пользовательскую схему URL для открытия приложения. Вот примеры приложений, поддерживающих глубокие ссылки:
>
> *   Figma: `figma://file/Your_Figma_ID`
> *   Firefox: `firefox://open-url?url=https://example.com/hello`
> *   Google Chrome: `googlechromes://example.com`
> *   Microsoft Edge: `microsoft-edge://example.com`
> *   Notion: `notion://www.notion.so/Your_Note_ID`
> *   Slack: `slack://open`

#### Приложение

![Supported Types: Original](https://img.shields.io/badge/Types-Original-blue) ![Supported Platforms: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Если вы хотите указать приложение, которое должно открывать целевой URL, используйте комбинированный список **Приложение**. Эта функция доступна только в macOS.

> [!WARNING]
> Вы можете открыть только приложение, поддерживающее [App Sandbox](https://developer.apple.com/documentation/security/app_sandbox). Также убедитесь, что приложение поддерживает открытие того URL, который вы хотите открыть.

### Обработка групп захвата

![Supported Types: Original](https://img.shields.io/badge/Types-Original-blue)

Параметр **Обработка групп захвата** позволяет указать, как обрабатывать захваченные группы, которые можно подставлять в параметр *Перенаправлять на* с помощью `$1`, `$2`...

Группы захвата создаются следующим образом:

*   **Маска (Wildcard)**: Тексты, соответствующие `*` и `?`, захватываются автоматически.
*   **Регулярное выражение**: Тексты, соответствующие части шаблона внутри `()`, захватываются.

Вы можете выбрать один или несколько следующих процессов:

*   **Кодирование/Декодирование URL**: Применяет [процентное кодирование](https://en.wikipedia.org/wiki/Percent-encoding) или декодирование к группе захвата. Например, если вы кодируете `https://example.com/hello`, оно преобразуется в `https%3A%2F%2Fexample.com%2Fhello`. Декодирование работает в обратном порядке.
*   **Кодирование/Декодирование Base64**: Декодирует/кодирует текст в [Base64](https://en.wikipedia.org/wiki/Base64). Например, вы можете закодировать `hello` в `aGVsbG8=`, а затем декодировать обратно в `hello`.
*   **Замена вхождений**: Заменяет один или несколько символов в группе, соответствующих **Цели**, на **Замену**. Например, если *Группа* — `hello`, *Цель* — `l`, а Замена — `y`, то она будет изменена на `heyyo`.

> [!NOTE]
> Это предназначено для обработки каждой группы захвата и не влияет на то, какие URL исключаются с помощью [Исключенных шаблонов URL](#excluded-url-patterns). Например, предположим, у вас есть такое правило:
>
> *   **Перенаправлять с**: `https://example.com/(hello.*)`
> *   **Обработка групп захвата**:
>     *   Группа: `$1`
>     *   Цель: `.*` (Регулярное выражение)
>     *   Замена: `hello`
> *   **Исключенный шаблон URL**: `https://example.com/hello`
>
> В этом случае `https://example.com/hello_world` не будет исключен, в то время как `https://example.com/hello` будет исключен.

### Исключенные шаблоны URL

![Supported Types: Original](https://img.shields.io/badge/Types-Original-blue)

Параметр **Исключенные шаблоны URL** позволяет указать URL, которые не будут перенаправляться. Это может быть полезно для предотвращения циклов перенаправления или для исключения определенных частей веб-сайта из перенаправления.

Вы можете указывать исключенные шаблоны URL, используя либо регулярные выражения, либо маски.

### Примеры

Параметр **Примеры** позволяет протестировать ваше правило перенаправления, предоставив образцы URL. Добавив образец URL, вы можете проверить, работает ли правило так, как ожидалось, прежде чем применять его.

### Комментарии

Параметр **Комментарии** позволяет добавлять любые заметки или комментарии о вашем правиле перенаправления. Это может быть полезно для отслеживания причин создания конкретного правила или для предоставления контекста для других пользователей, которые могут просматривать ваши правила.

## Шаблон URL

Существует 3 параметра, в которых вы можете указать один или несколько шаблонов URL: *Перенаправлять с*, *Исключенные шаблоны URL* и *Обработка групп захвата*. Для их указания вы можете выбрать либо **Маску (Wildcard)**, либо **Регулярное выражение**.

### Маска (Wildcard)

**Маска (Wildcard)** — это более простой тип шаблона, который позволяет использовать `*` (совпадает с чем угодно) и `?` (совпадает с любым отдельным символом) в качестве символов подстановки. Вот несколько примеров:

*   Чтобы соответствовать `https://example.com/hello`, вы можете использовать `https://example.com/*`. Это будет соответствовать любой строке после `https://example.com/`.
*   Чтобы соответствовать `https://example.com/search?q=hello`, вы можете использовать `https://example.com/search?q=*`. Это будет соответствовать любому значению параметра `q`.
*   Чтобы соответствовать любому URL, содержащему слово `blog`, вы можете использовать `*blog*`.

Вы также можете использовать подстановки в масках (Wildcard), что означает, что вы можете ссылаться на части соответствующего URL, используя `$1`, `$2` и т.д. Например, если вы используете `https://example.com/*-world-*`, а URL — `https://example.com/hello-world-goodbye`, то `$1` будет "hello", а `$2` — "goodbye". `$0` также доступен для ссылки на весь соответствующий URL.

> [!NOTE]
> Хотя подстановка является функцией регулярного выражения, вы также можете использовать ее для маски (Wildcard), потому что Redirect Web внутренне преобразует маску в регулярное выражение.

### Регулярное выражение

**Регулярное выражение** (Regex) — это мощный инструмент для сопоставления шаблонов в тексте, работающий на основе механизма регулярных выражений Apple, который описан [здесь](https://developer.apple.com/documentation/foundation/nsregularexpression#1661042). Оно позволяет определить конкретный шаблон, соответствующий набору строк. Вот несколько примеров.

*   Чтобы соответствовать `https://example.com/hello`, вы можете использовать `https://example.com/(.*)`. Это будет соответствовать любой строке после `https://example.com/` и сохранять ее в группе захвата.
*   Чтобы соответствовать `https://example.com/search?q=hello`, вы можете использовать `https://example.com/search\?q=(.*)`. Это будет соответствовать значению параметра `q` и сохранять его в группе захвата.
*   Чтобы соответствовать любому URL, содержащему слово `blog`, вы можете использовать `.*blog.*`.

Вы можете ссылаться на группы захвата в *Перенаправлять на* или *Замена*, используя `$1`, `$2`, ... или `$0` для ссылки на все совпадение.

Более подробную информацию о синтаксисе регулярных выражений можно найти в таких ресурсах, как [RegExr](https://regexr.com/).
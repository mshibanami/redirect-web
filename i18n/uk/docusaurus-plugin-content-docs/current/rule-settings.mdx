# Налаштування правил

Ця сторінка містить детальну інформацію про кожне налаштування на екрані редагування правил у програмі Redirect Web.

## Опції

### Тип {#type}

Вкажіть опцію **Тип**, щоб контролювати, як програма обробляє перенаправлення. Ви можете вибрати з наступних:

* **Оригінальний** (За замовчуванням)
    * Використовує традиційні веб-API для керування перенаправленням. Додатково, він використовує [Tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) для резервного варіанту.
        * У Firefox він використовує [WebRequest API](https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) для обробки перенаправлення.
    * Ви можете використовувати всі опції, крім [Типів ресурсів](#resource-types) та [Методів запиту](#request-methods).
    * Це повільніше, ніж тип *Декларативний*, і може спричинити додаткові мережеві запити.
* **DNR** (Експериментальний для Safari):
    * Цей тип працює набагато швидше, ніж оригінальний тип, оскільки він не ініціює мережевий запит для вихідної URL-адреси.
    * Це дозволяє вказувати [Типи ресурсів](#resource-types) та [Методи запиту](#request-methods).
    * ⚠️ Ви не можете використовувати деякі опції, такі як [Обробка груп захоплення](#capturing-group-processing) та [Виключені шаблони URL-адрес](#excluded-url-patterns), оскільки вони ще не підтримуються DNR API.
    * ⚠️ У Safari наразі ви не можете включати вертикальні риски (`|`) у свій шаблон регулярного виразу. [Деталі](https://github.com/mshibanami/redirect-web/issues/44)
    * ⚠️ Оскільки DNR API Safari все ще має деякі проблеми, ми вважаємо, що це все ще експериментальна функція для Safari. Ви можете знайти список усіх відомих проблем [тут](https://github.com/mshibanami/redirect-web/issues?q=state%3Aopen%20label%3ADNR%20label%3ASafari).

### Перенаправити з {#redirect-from}

Опція **Перенаправити з** дозволяє вказати шаблон URL-адреси веб-сторінок, з яких ви хочете перенаправити. Ви можете вибрати [Wildcard](#wildcard) або [Регулярний вираз](#regular-expression).

Наприклад, якщо ви вкажете `https://example.com/*` з Wildcard, він відповідатиме `https://example.com/` або `https://example.com/hello`.

> [!NOTE]
> В опції "Перенаправити на" ви можете посилатися на весь збіг за допомогою `$0` або часткові збіги за допомогою `$1`, `$2`, ... Перевірте деталі в [Шаблоні URL-адреси](#url-pattern) на цій сторінці.

#### Типи ресурсів {#resource-types}

![Підтримувані типи: DNR](https://img.shields.io/badge/Types-DNR-blue)

Опція **Типи ресурсів** дозволяє вказати категорії веб-запитів, такі як зображення, JavaScript та таблиці стилів, до яких застосовується правило.
Наприклад, якщо ви встановите `script`, ви можете перенаправляти файли JavaScript, завантажені веб-сторінками.

Наразі доступні такі: 
`main_frame`, `sub_frame`, `stylesheet`, `script`, `image`, `font`, `xmlhttprequest`, `ping`, `media`, `websocket`, `other`

Налаштування за замовчуванням – `main_frame`, що є сторінкою верхнього рівня, завантаженою у вкладку.

Будь ласка, перевірте деталі кожного типу ресурсу в [mdn web docs](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/declarativeNetRequest/ResourceType).

#### Методи запиту {#request-methods}

![Підтримувані типи: DNR](https://img.shields.io/badge/Types-DNR-blue)

Опція **Методи запиту** дозволяє встановити цільові HTTP-методи вихідної URL-адреси.

За замовчуванням встановлені всі методи.

Будь ласка, перевірте деталі кожного методу в [mdn web docs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods).

> [!WARNING]
> У Safari ця опція може бути недоступною, оскільки реалізація Apple для типу DNR, схоже, наразі не обробляє її. Ми надіслали відгук Apple як FB14502272.

#### Цільові браузери {#target-browsers}

![Підтримувані платформи: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Опція **Цільові браузери** дозволяє вказати, до якого браузера правило повинно або не повинно застосовуватися.

* Є 2 типи браузерів, які ви можете вибрати:
    * **Браузери, які ви можете вибрати за замовчуванням**: За замовчуванням ви можете вибрати Safari, Chrome, Firefox, Edge, Opera, Arc, Brave та Vivaldi. Це не розрізняє варіанти одного й того ж браузера, такі як Safari та Safari Technology Preview.
    * **Браузери, вказані користувачем**: Натиснувши кнопку "Додати" у спливаючому вікні, ви можете вибрати будь-який браузер, крім Safari або Safari Technology Preview, у якому встановлено розширення Redirect Web.
* Прапорець **Усі, крім вибраних** дозволяє націлюватися на кожен браузер, крім тих, які ви вибрали.

> [!WARNING]
> Redirect Web не може розрізнити, чи є браузер **Safari** чи **Safari Technology Preview**, оскільки програма перевіряє батьківський процес розширення для його виявлення, але ці два браузери використовують один і той же батьківський процес (`/sbin/launchd`).

### Перенаправити на {#redirect-to}

Опція **Перенаправити на** вказує цільову URL-адресу, на яку ви хочете перенаправити з вихідної URL-адреси, що відповідає опції *Перенаправити з*. Ви також можете замінити групи захоплення за допомогою `$1`, `$2`, ... або весь збіг за допомогою `$0`. Це допомагає динамічно вказувати призначення. Перевірте деталі в [Шаблоні URL-адреси](#url-pattern) на цій сторінці.

Наприклад, якщо ви встановите наступне правило:

* **Перенаправити з**: `https://google.com/*` (Wildcard)
* **Перенаправити на**: `https://apple.com/$1`

і воно відповідає `https://google.com/hello`, тоді цільова URL-адреса буде `https://apple.com/hello`.

Крім того, ви можете змінювати тексти `$1`, `$2`, ... перед виконанням підстановок. Перевірте розділ [Обробка груп захоплення](#capturing-group-processing) для отримання деталей.

> [!TIP]
> Ви можете вказати власну схему URL-адреси для відкриття програми. Це приклади програм, які підтримують глибокі посилання:
>
> * Figma: `figma://file/Your_Figma_ID`
> * Firefox: `firefox://open-url?url=https://example.com/hello`
> * Google Chrome: `googlechromes://example.com`
> * Microsoft Edge: `microsoft-edge://example.com`
> * Notion: `notion://www.notion.so/Your_Note_ID`
> * Slack: `slack://open`

#### Застосування {#application}

![Підтримувані типи: Оригінальний](https://img.shields.io/badge/Types-Original-blue) ![Підтримувані платформи: macOS](https://img.shields.io/badge/Platforms-macOS-white)

Якщо ви хочете вказати програму, яку ви хочете відкрити цільову URL-адресу, використовуйте комбінований список **Застосування**. Це доступно лише на macOS.

> [!WARNING]
> Ви можете відкривати лише програму, яка підтримує [App Sandbox](https://developer.apple.com/documentation/security/app_sandbox). Також переконайтеся, що програма підтримує відкриття URL-адреси, яку ви хочете відкрити.

### Обробка груп захоплення {#capturing-group-processing}

![Підтримувані типи: Оригінальний](https://img.shields.io/badge/Types-Original-blue)

Опція **Обробка груп захоплення** дозволяє вказати, як обробляти захоплені групи, які ви можете підставляти в опції *Перенаправити на* за допомогою `$1`, `$2`...

Ось як створювати групи захоплення:

* **Wildcard**: Тексти, що відповідають `*` та `?`, автоматично захоплюються.
* **Регулярний вираз**: Тексти, що відповідають частині шаблону всередині `()`, захоплюються.

Ви можете вибрати один або кілька з наступних процесів:

* **Кодування/декодування URL**: Застосовує [відсоткове кодування](https://en.wikipedia.org/wiki/Percent-encoding) або декодування до групи захоплення. Наприклад, якщо ви кодуєте `https://example.com/hello`, воно перетворюється на `https%3A%2F%2Fexample.com%2Fhello`. Декодування працює навпаки.
* **Кодування/декодування Base64**: Декодує/кодує текст у [Base64](https://en.wikipedia.org/wiki/Base64). Наприклад, ви можете закодувати `hello` в `aGVsbG8=`, а потім декодувати його назад в `hello`.
* **Замінити входження**: Замінює один або кілька символів у групі, що відповідає **Цілі**, на **Заміну**. Наприклад, якщо *Група* – `hello`, а *Ціль* – `l`, а *Заміна* – `y`, вона змінюється на `heyyo`.

> [!NOTE]
> Це призначено для обробки кожної групи захоплення і не впливає на те, які URL-адреси виключаються [Виключеними шаблонами URL-адрес](#excluded-url-patterns). Наприклад, припустимо, у вас є таке правило:
>
> * **Перенаправити з**: `https://example.com/(hello.*)`
> * **Обробка груп захоплення**:
>     * Група: `$1`
>     * Ціль: `.*` (Регулярний вираз)
>     * Заміна: `hello`
> * **Виключений шаблон URL-адреси**: `https://example.com/hello`
>
> У цьому випадку `https://example.com/hello_world` не буде виключено, тоді як `https://example.com/hello` буде виключено.

### Виключені шаблони URL-адрес {#excluded-url-patterns}

![Підтримувані типи: Оригінальний](https://img.shields.io/badge/Types-Original-blue)

Опція **Виключені шаблони URL-адрес** дозволяє вказати URL-адреси, які не перенаправляються. Це може бути корисно, щоб уникнути циклів перенаправлення або виключити певні частини веб-сайту з перенаправлення.

Ви можете вказати виключені шаблони URL-адрес, використовуючи типи шаблонів Regular Expression або Wildcard.

### Приклади {#examples}

Опція **Приклади** дозволяє перевірити ваше правило перенаправлення, надавши зразки URL-адрес. Додавши зразок URL-адреси, ви можете перевірити, чи працює правило, як очікувалося, перш ніж фактично застосовувати його.

### Коментарі {#comments}

Опція **Коментарі** дозволяє додавати будь-які нотатки або коментарі щодо вашого правила перенаправлення. Це може бути корисно для відстеження того, чому ви створили певне правило, або для надання контексту для інших, хто може переглядати ваші правила.

## Шаблон URL-адреси {#url-pattern}

Є 3 опції, за допомогою яких ви можете вказати один або кілька шаблонів URL-адрес. *Перенаправити з*, *Виключені шаблони URL-адрес* та *Обробка груп захоплення*. Щоб вказати їх, ви можете вибрати **Wildcard** або **Регулярний вираз**.

### Wildcard {#url-pattern-wildcard}

**Wildcard** – це простіший тип шаблону, який дозволяє використовувати `*` (відповідає будь-чому) та `?` (відповідає будь-якому одному символу) як підстановочні знаки. Ось кілька прикладів:

* Щоб відповідати `https://example.com/hello`, ви можете використовувати `https://example.com/*`. Це відповідатиме будь-якому рядку після `https://example.com/`.
* Щоб відповідати `https://example.com/search?q=hello`, ви можете використовувати `https://example.com/search?q=*`. Це відповідатиме будь-якому значенню параметра `q`.
* Щоб відповідати будь-якій URL-адресі, що містить слово `blog`, ви можете використовувати `*blog*`.

Ви також можете використовувати підстановку в Wildcard, що означає, що ви можете посилатися на частини відповідної URL-адреси за допомогою `$1`, `$2` тощо. Наприклад, якщо ви використовуєте `https://example.com/*-world-*`, а URL-адреса – `https://example.com/hello-world-goodbye`, тоді `$1` буде "hello", а `$2` – "goodbye". `$0` також доступний для посилання на всю відповідну URL-адресу.

> [!NOTE]
> Хоча підстановка є функцією регулярного виразу, ви також можете використовувати її для Wildcard, оскільки Redirect Web внутрішньо перетворює Wildcard на регулярний вираз.

### Регулярний вираз {#url-pattern-regular-expression}

**Регулярний вираз** (Regex) – це потужний інструмент для зіставлення шаблонів у тексті, що працює на основі механізму регулярних виразів Apple, описаного [тут](https://developer.apple.com/documentation/foundation/nsregularexpression#1661042). Він дозволяє визначити конкретний шаблон, який відповідає набору рядків. Ось кілька прикладів.

- Щоб відповідати `https://example.com/hello`, ви можете використовувати `https://example.com/(.*)`. Це відповідатиме будь-якому рядку після `https://example.com/` і зберігатиме його в групі захоплення.
- Щоб відповідати `https://example.com/search?q=hello`, ви можете використовувати `https://example.com/search\?q=(.*)`. Це відповідатиме значенню параметра `q` і зберігатиме його в групі захоплення.
- Щоб відповідати будь-якій URL-адресі, що містить слово `blog`, ви можете використовувати `.*blog.*`.

Ви можете посилатися на групи захоплення в *Перенаправити на* або *Заміна* за допомогою `$1`, `$2`, ... або `$0` для посилання на весь збіг.

Більше інформації про синтаксис Regex можна знайти в таких ресурсах, як [RegExr](https://regexr.com/).
